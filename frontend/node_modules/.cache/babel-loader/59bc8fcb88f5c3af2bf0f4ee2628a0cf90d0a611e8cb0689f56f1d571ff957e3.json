{"ast":null,"code":"import axios from 'axios';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3000/api/v1';\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n    Accept: 'application/json'\n  }\n});\n\n// Attach token from localStorage to every request\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// On responses, if the API returns a new token in `authorization` header, store it\napi.interceptors.response.use(response => {\n  const authHeader = response.headers['authorization'] || response.headers['Authorization'];\n  if (authHeader) {\n    // support `Bearer <token>` or raw token\n    const token = authHeader.startsWith('Bearer ') ? authHeader.split(' ')[1] : authHeader;\n    if (token) {\n      localStorage.setItem('token', token);\n      // notify app that auth changed\n      try {\n        window.dispatchEvent(new CustomEvent('authChanged', {\n          detail: {\n            authenticated: true\n          }\n        }));\n      } catch (e) {}\n    }\n  }\n  // Fallback: if the API included the token in the JSON body (data.token or data?.data?.token), store it\n  try {\n    var _response$data, _response$data2, _response$data2$data;\n    const bodyToken = (response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.token) || (response === null || response === void 0 ? void 0 : (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : (_response$data2$data = _response$data2.data) === null || _response$data2$data === void 0 ? void 0 : _response$data2$data.token) || null;\n    if (bodyToken && !localStorage.getItem('token')) {\n      localStorage.setItem('token', bodyToken);\n      try {\n        window.dispatchEvent(new CustomEvent('authChanged', {\n          detail: {\n            authenticated: true\n          }\n        }));\n      } catch (e) {}\n    }\n  } catch (e) {\n    // ignore parsing errors\n  }\n  return response;\n}, error => {\n  // Optionally handle global errors (401 -> remove token)\n  if (error.response && error.response.status === 401) {\n    localStorage.removeItem('token');\n    try {\n      window.dispatchEvent(new CustomEvent('authChanged', {\n        detail: {\n          authenticated: false\n        }\n      }));\n    } catch (e) {}\n  }\n  return Promise.reject(error);\n});\nexport default api;","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","api","create","baseURL","headers","Accept","interceptors","request","use","config","token","localStorage","getItem","Authorization","response","authHeader","startsWith","split","setItem","window","dispatchEvent","CustomEvent","detail","authenticated","e","_response$data","_response$data2","_response$data2$data","bodyToken","data","error","status","removeItem","Promise","reject"],"sources":["/home/saad/APIsPra/BizmindClone/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios'\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3000/api/v1'\n\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n    Accept: 'application/json'\n  }\n})\n\n// Attach token from localStorage to every request\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n  return config\n})\n\n// On responses, if the API returns a new token in `authorization` header, store it\napi.interceptors.response.use(\n  response => {\n    const authHeader = response.headers['authorization'] || response.headers['Authorization']\n    if (authHeader) {\n      // support `Bearer <token>` or raw token\n      const token = authHeader.startsWith('Bearer ') ? authHeader.split(' ')[1] : authHeader\n      if (token) {\n        localStorage.setItem('token', token)\n        // notify app that auth changed\n        try { window.dispatchEvent(new CustomEvent('authChanged', { detail: { authenticated: true } })) } catch (e) {}\n      }\n    }\n    // Fallback: if the API included the token in the JSON body (data.token or data?.data?.token), store it\n    try {\n      const bodyToken = response?.data?.token || response?.data?.data?.token || null\n      if (bodyToken && !localStorage.getItem('token')) {\n        localStorage.setItem('token', bodyToken)\n        try { window.dispatchEvent(new CustomEvent('authChanged', { detail: { authenticated: true } })) } catch (e) {}\n      }\n    } catch (e) {\n      // ignore parsing errors\n    }\n    return response\n  },\n  error => {\n    // Optionally handle global errors (401 -> remove token)\n    if (error.response && error.response.status === 401) {\n      localStorage.removeItem('token')\n      try { window.dispatchEvent(new CustomEvent('authChanged', { detail: { authenticated: false } })) } catch (e) {}\n    }\n    return Promise.reject(error)\n  }\n)\n\nexport default api\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}